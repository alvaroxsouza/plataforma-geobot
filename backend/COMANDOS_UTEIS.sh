#!/bin/bash
# Script de comandos √∫teis para o projeto Geobot Plataforma Backend

# Cores para output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${GREEN}‚ïë     Comandos √öteis - Geobot Plataforma Backend      ‚ïë${NC}"
echo -e "${GREEN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

echo -e "${YELLOW}üì¶ SETUP INICIAL:${NC}"
echo "  cp .env.example .env                    # Copiar template de vari√°veis"
echo "  createdb geobot_db                      # Criar banco de dados"
echo "  python test_setup.py                    # Testar configura√ß√£o"
echo "  python manage_db.py upgrade             # Executar migrations"
echo ""

echo -e "${YELLOW}üöÄ APLICA√á√ÉO:${NC}"
echo "  python app.py                           # Iniciar aplica√ß√£o FastAPI"
echo "  uvicorn src.geobot_plataforma_backend.app_fastapi:app --reload"
echo ""

echo -e "${YELLOW}üóÑÔ∏è MIGRATIONS:${NC}"
echo "  python manage_db.py check               # Verificar migrations pendentes"
echo "  python manage_db.py upgrade             # Executar migrations"
echo "  python manage_db.py current             # Ver vers√£o atual"
echo "  python manage_db.py history             # Ver hist√≥rico"
echo "  python manage_db.py create -m 'msg'     # Criar nova migration"
echo "  python manage_db.py downgrade           # Desfazer √∫ltima migration"
echo ""

echo -e "${YELLOW}üß™ TESTES:${NC}"
echo "  python test_setup.py                    # Testar configura√ß√£o completa"
echo "  pytest                                  # Executar testes (quando dispon√≠vel)"
echo ""

echo -e "${YELLOW}üóÑÔ∏è BANCO DE DADOS:${NC}"
echo "  # PostgreSQL"
echo "  psql -U postgres -d geobot_db           # Conectar ao banco"
echo "  pg_dump geobot_db > backup.sql          # Fazer backup"
echo "  psql geobot_db < backup.sql             # Restaurar backup"
echo ""
echo "  # Ver tabelas e dados"
echo "  psql -U postgres -d geobot_db -c '\\dt'  # Listar tabelas"
echo "  psql -U postgres -d geobot_db -c 'SELECT * FROM grupos;'"
echo "  psql -U postgres -d geobot_db -c 'SELECT * FROM roles;'"
echo ""

echo -e "${YELLOW}üê≥ DOCKER:${NC}"
echo "  docker-compose up -d                    # Iniciar containers"
echo "  docker-compose down                     # Parar containers"
echo "  docker-compose logs -f                  # Ver logs"
echo "  docker-compose exec app python manage_db.py upgrade"
echo ""

echo -e "${YELLOW}üîß DESENVOLVIMENTO:${NC}"
echo "  # Criar nova migration ap√≥s mudar models"
echo "  python manage_db.py create -m 'adicionar_campo_x'"
echo ""
echo "  # Verificar status"
echo "  python -c 'from src.geobot_plataforma_backend.core.database import check_db_connection; print(check_db_connection())'"
echo ""
echo "  # Listar tabelas via Python"
echo "  python -c 'from src.geobot_plataforma_backend.core.database import engine; from sqlalchemy import inspect; print(inspect(engine).get_table_names())'"
echo ""

echo -e "${YELLOW}üìö DOCUMENTA√á√ÉO:${NC}"
echo "  cat SETUP_SUMMARY.md                    # Resumo da configura√ß√£o"
echo "  cat MIGRATIONS_README.md                # Guia de migrations"
echo "  cat README.md                           # README principal"
echo ""

echo -e "${YELLOW}üÜò TROUBLESHOOTING:${NC}"
echo "  # Resetar banco (CUIDADO: apaga tudo!)"
echo "  psql -U postgres -c 'DROP DATABASE geobot_db;'"
echo "  psql -U postgres -c 'CREATE DATABASE geobot_db;'"
echo "  python manage_db.py upgrade"
echo ""
echo "  # Verificar configura√ß√£o"
echo "  python -c 'from src.geobot_plataforma_backend.core.config import settings; print(settings.as_dict())'"
echo ""
echo "  # Resolver m√∫ltiplas heads (branches) no Alembic"
echo "  alembic heads                           # Ver todas as heads"
echo "  alembic history                         # Ver hist√≥rico completo"
echo "  alembic merge -m 'merge_branches' <rev1> <rev2>  # Mesclar branches"
echo "  alembic stamp <revision>                # For√ßar vers√£o sem executar"
echo ""
echo "  # For√ßar migration para uma vers√£o"
echo "  alembic stamp head                      # Marcar como atualizado"
echo "  alembic stamp base                      # Marcar como vazio"
echo ""

echo -e "${GREEN}‚ú® Para mais detalhes, consulte a documenta√ß√£o em:${NC}"
echo "   - SETUP_SUMMARY.md"
echo "   - MIGRATIONS_README.md"
echo "   - README.md"
echo ""

